<h2 class="text-xl font-bold mb-4">Pregled</h2>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
  <div class="lg:col-span-2 space-y-4">
    <!-- Address -->
    <section class="bg-white p-4 rounded-xl shadow-sm animate__animated animate__fadeInUp">
      <h3 class="font-semibold mb-3">Adresa za isporuku</h3>

      <!-- Existing addresses -->
      <div *ngIf="addresses().length" class="space-y-2 mb-3">
        <div class="text-sm text-gray-600">Odaberite adresu ili unesite novu:</div>
        <label *ngFor="let a of addresses()" class="block border rounded-lg p-3 cursor-pointer">
          <input type="radio" name="addr" class="mr-2"
                 [checked]="selectedAddressId()===a.id" (change)="selectedAddressId.set(a.id!); useNewAddress.set(false)" />
          <span class="font-medium">{{ a.fullName }}</span>
          <div class="text-sm text-gray-600">
            {{ a.addressLine1 }}<span *ngIf="a.addressLine2">, {{ a.addressLine2 }}</span>, {{ a.city }} {{ a.postalCode }}, {{ a.countryCode }}
          </div>
          <div class="text-xs text-gray-500" *ngIf="a.phone">Telefon: {{ a.phone }}</div>
        </label>
      </div>

      <div class="flex items-center gap-2 mb-2">
        <input id="useNew" type="checkbox" [checked]="useNewAddress()" (change)="onUseNewToggle($any($event.target).checked)" />
        <label for="useNew">Unesi novu adresu</label>
      </div>

      <!-- New address form -->
      <div *ngIf="useNewAddress()" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <input class="border rounded p-2 w-full" placeholder="Ime i prezime*"
               [ngModel]="newAddress().fullName" (ngModelChange)="updateNew('fullName', $event)" />
        <div class="text-xs text-red-600 sm:col-span-2" *ngIf="addrErrors()['fullName']">{{ addrErrors()['fullName'] }}</div>
        <input class="border rounded p-2 w-full" placeholder="Telefon"
               [ngModel]="newAddress().phone" (ngModelChange)="updateNew('phone', $event)" />
        <input class="border rounded p-2 w-full sm:col-span-2" placeholder="Adresa*"
               [ngModel]="newAddress().addressLine1" (ngModelChange)="updateNew('addressLine1', $event)" />
        <div class="text-xs text-red-600 sm:col-span-2" *ngIf="addrErrors()['addressLine1']">{{ addrErrors()['addressLine1'] }}</div>
        <input class="border rounded p-2 w-full sm:col-span-2" placeholder="Adresa 2"
               [ngModel]="newAddress().addressLine2" (ngModelChange)="updateNew('addressLine2', $event)" />
        <input class="border rounded p-2 w-full" placeholder="Grad*"
               [ngModel]="newAddress().city" (ngModelChange)="updateNew('city', $event)" />
        <div class="text-xs text-red-600" *ngIf="addrErrors()['city']">{{ addrErrors()['city'] }}</div>
        <input class="border rounded p-2 w-full" placeholder="Država (kod)*"
               [ngModel]="newAddress().countryCode" (ngModelChange)="updateNew('countryCode', $event)" />
        <div class="text-xs text-red-600" *ngIf="addrErrors()['countryCode']">{{ addrErrors()['countryCode'] }}</div>
        <input class="border rounded p-2 w-full" placeholder="Poštanski broj*"
               [ngModel]="newAddress().postalCode" (ngModelChange)="updateNew('postalCode', $event)" />
        <div class="text-xs text-red-600" *ngIf="addrErrors()['postalCode']">{{ addrErrors()['postalCode'] }}</div>
        <input class="border rounded p-2 w-full" placeholder="Okrug/Regija"
               [ngModel]="newAddress().state" (ngModelChange)="updateNew('state', $event)" />
        <input class="border rounded p-2 w-full" placeholder="Oznaka (npr. Home)"
               [ngModel]="newAddress().label" (ngModelChange)="updateNew('label', $event)" />
        <div class="sm:col-span-2 text-xs text-gray-600" *ngIf="!requiredValid()">Polja označena * su obavezna.</div>
        <div class="sm:col-span-2 text-xs text-red-600" *ngIf="generalError()">{{ generalError() }}</div>
      </div>
    </section>

    <!-- Payment -->
    <section class="bg-white p-4 rounded-xl shadow-sm animate__animated animate__fadeInUp">
      <h3 class="font-semibold mb-3">Plaćanje</h3>
      <div class="flex gap-2 text-sm">
        <button (click)="method.set('now')" [class]!="method() === 'now' ? 'bg-brand-600 text-white' : 'bg-gray-100'" class="px-3 py-1.5 rounded-lg transition">Plati odmah</button>
        <button (click)="method.set('cod')" [class]!="method() === 'cod' ? 'bg-brand-600 text-white' : 'bg-gray-100'" class="px-3 py-1.5 rounded-lg transition">Plaćanje pouzećem</button>
      </div>

      <div *ngIf="method() === 'now'" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 animate__animated animate__fadeIn">
        <input placeholder="Ime na kartici" class="w-full rounded-lg border p-2 sm:col-span-2" />
        <input placeholder="Broj kartice" class="w-full rounded-lg border p-2 sm:col-span-2" />
        <input placeholder="MM/YY" class="w-full rounded-lg border p-2" />
        <input placeholder="CVC" class="w-full rounded-lg border p-2" />
      </div>
      <div *ngIf="method() === 'cod'" class="mt-4 text-sm text-gray-600 animate__animated animate__fadeIn">
        Plaćanje gotovinom ili karticom prilikom isporuke.
      </div>
    </section>
  </div>

  <!-- Summary -->
  <aside class="bg-white p-4 rounded-xl shadow-sm h-fit animate__animated animate__fadeIn">
    <h3 class="font-semibold mb-3">Sažetak</h3>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between"><span>Međuzbir</span><span>{{ cart.totalPrice() | currency:'RSD':'symbol':'1.0-0':'sr-RS' }}</span></div>
      <div class="flex justify-between"><span>Isporuka</span><span>Besplatna</span></div>
      <div class="flex justify-between font-semibold text-lg pt-2 border-t"><span>Ukupno</span><span>{{ cart.totalPrice() | currency:'RSD':'symbol':'1.0-0':'sr-RS' }}</span></div>
    </div>
    <button (click)="placeOrder()" class="mt-4 w-full px-4 py-3 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold active:scale-95 transition">Potvrdi porudžbinu</button>
    <a routerLink="/korpa" class="block text-center mt-2 text-sm text-gray-500 hover:text-gray-700">Nazad u korpu</a>
  </aside>
</div>

