<div class="space-y-6">
  <h2 class="text-xl font-bold">Admin panel</h2>

  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
    <div class="bg-white rounded-xl p-4 shadow-sm">
      <div class="text-sm text-gray-500">Sve porudžbine</div>
      <div class="text-2xl font-semibold">{{ orders.orders().length }}</div>
    </div>
    <div class="bg-white rounded-xl p-4 shadow-sm">
      <div class="text-sm text-gray-500">Na čekanju (neisporučene)</div>
      <div class="text-2xl font-semibold">{{ orders.pending().length }}</div>
    </div>
    <div class="bg-white rounded-xl p-4 shadow-sm">
      <div class="text-sm text-gray-500">Plaćene</div>
      <div class="text-2xl font-semibold">{{ orders.paid().length }}</div>
    </div>
    <div class="bg-white rounded-xl p-4 shadow-sm">
      <div class="text-sm text-gray-500">Neplaćene</div>
      <div class="text-2xl font-semibold">{{ orders.unpaid().length }}</div>
    </div>
  </div>

  <!-- Orders list -->
  <section class="bg-white rounded-xl shadow-sm">
    <div class="p-4 border-b font-semibold">Porudžbine</div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
        <tr class="text-left text-gray-600">
          <th class="p-3">ID</th>
          <th class="p-3">Kupac</th>
          <th class="p-3">Vreme</th>
          <th class="p-3">Ukupno</th>
          <th class="p-3">Plaćeno</th>
          <th class="p-3">Isporučeno</th>
          <th class="p-3">Akcije</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let o of orders.orders()" class="border-t">
          <td class="p-3 align-top font-mono text-xs">{{ o.id.slice(0,8) }}</td>
          <td class="p-3 align-top">
            <div class="font-medium">{{ o.user?.name || 'Gost' }}</div>
            <div class="text-gray-500">{{ o.user?.email || '-' }}</div>
          </td>
          <td class="p-3 align-top">{{ o.createdAt | date:'short' }}</td>
          <td class="p-3 align-top font-semibold">{{ o.total | currency:'RSD':'symbol':'1.0-0':'sr-RS' }}</td>
          <td class="p-3 align-top">
            <span class="px-2 py-0.5 rounded-full text-xs" [class]="o.paid ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-800'">
              {{ o.paid ? 'Plaćeno' : 'Čeka uplatu' }}
            </span>
          </td>
          <td class="p-3 align-top">
            <span class="px-2 py-0.5 rounded-full text-xs" [class]="o.shipped ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'">
              {{ o.shipped ? 'Isporučeno' : 'Na čekanju' }}
            </span>
          </td>
          <td class="p-3 align-top">
            <div class="flex gap-2">
              <button (click)="orders.markPaid(o.id, !o.paid)" class="px-3 py-1.5 rounded-lg bg-gray-100 hover:bg-gray-200">
                {{ o.paid ? 'Označi neplaćeno' : 'Označi plaćeno' }}
              </button>
              <button (click)="orders.markShipped(o.id, !o.shipped)" class="px-3 py-1.5 rounded-lg bg-brand-600 text-white hover:bg-brand-700">
                {{ o.shipped ? 'Vrati u čekanju' : 'Označi isporučeno' }}
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="!orders.orders().length">
          <td colspan="7" class="p-6 text-center text-gray-500">Nema porudžbina još uvek.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Product management (backend) -->
  <section class="bg-white rounded-xl shadow-sm">
    <div class="p-4 border-b font-semibold">Proizvodi (backend)</div>
    <div class="p-4">
      <div class="grid grid-cols-1 md:grid-cols-6 gap-2 items-end">
        <input class="border rounded p-2 w-full md:col-span-2" placeholder="Naziv" [ngModel]="create().name" (ngModelChange)="setCreate('name', $event)" />
        <div class="text-xs text-red-600 md:col-span-2" *ngIf="createErrs()['name']">{{ createErrs()['name'] }}</div>
        <input class="border rounded p-2 w-full md:col-span-2" placeholder="Opis" [ngModel]="create().description" (ngModelChange)="setCreate('description', $event)" />
        <input class="border rounded p-2 w-full" type="number" placeholder="Cena" [ngModel]="create().price" (ngModelChange)="setCreate('price', $event)" />
        <div class="text-xs text-red-600" *ngIf="createErrs()['price']">{{ createErrs()['price'] }}</div>
        <input class="border rounded p-2 w-full" type="number" placeholder="Količina" [ngModel]="create().stockQuantity" (ngModelChange)="setCreate('stockQuantity', $event)" />
        <div class="text-xs text-red-600" *ngIf="createErrs()['stockQuantity']">{{ createErrs()['stockQuantity'] }}</div>
        <label class="inline-flex items-center gap-2 md:col-span-2"><input type="checkbox" [checked]="create().featured" (change)="setCreate('featured', $any($event.target).checked)" /> Istaknut</label>
        <select class="border rounded p-2 w-full md:col-span-2" [ngModel]="create().categoryId" (ngModelChange)="setCreate('categoryId', $event)">
          <option [ngValue]="null">Bez kategorije</option>
          <option *ngFor="let c of categories()" [ngValue]="c.id">{{ c.name }}</option>
        </select>
        <button (click)="doCreate()" class="px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold">Dodaj proizvod</button>
      </div>
      <div class="text-xs text-red-600 mt-1" *ngIf="createError()">{{ createError() }}</div>
    </div>
    <div class="divide-y">
      <div *ngFor="let p of products()" class="p-4">
        <div class="flex items-center gap-4">
          <img [src]="p.mainImageUrl || 'assets/placeholder-product.svg'" (error)="onImgError($event)" alt="" class="w-14 h-14 object-cover rounded-lg border" />
          <div class="flex-1 min-w-0">
            <div class="font-medium truncate">{{ p.name }}</div>
            <div class="text-xs text-gray-500">#{{ p.id }}</div>
          </div>
          <div class="flex items-center gap-3">
            <div class="text-sm text-gray-600">Cena: <span class="font-semibold">{{ p.price | currency:'RSD':'symbol':'1.0-0':'sr-RS' }}</span></div>
            <div class="text-sm text-gray-600">Na stanju: <span class="font-semibold">{{ p.stockQuantity }}</span></div>
            <button (click)="startEdit(p.id)" class="px-3 py-1.5 rounded-lg bg-gray-100 hover:bg-gray-200">Uredi</button>
            <button (click)="del(p.id)" class="px-3 py-1.5 rounded-lg bg-red-600 text-white hover:bg-red-700">Obriši</button>
          </div>
        </div>
        <div *ngIf="editProd()[p.id] as e" class="mt-3 grid grid-cols-1 md:grid-cols-6 gap-2">
          <input class="border rounded p-2 w-full md:col-span-2" placeholder="Naziv" [ngModel]="e.name" (ngModelChange)="setEditField(p.id, 'name', $event)" />
          <div class="text-xs text-red-600 md:col-span-2" *ngIf="editProdFieldErrors()[p.id]?.['name']">{{ editProdFieldErrors()[p.id]['name'] }}</div>
          <input class="border rounded p-2 w-full md:col-span-2" placeholder="Opis" [ngModel]="e.description" (ngModelChange)="setEditField(p.id, 'description', $event)" />
          <input class="border rounded p-2 w-full" type="number" placeholder="Cena" [ngModel]="e.price" (ngModelChange)="setEditField(p.id, 'price', $event)" />
          <div class="text-xs text-red-600" *ngIf="editProdFieldErrors()[p.id]?.['price']">{{ editProdFieldErrors()[p.id]['price'] }}</div>
          <input class="border rounded p-2 w-full" type="number" placeholder="Količina" [ngModel]="e.stockQuantity" (ngModelChange)="setEditField(p.id, 'stockQuantity', $event)" />
          <div class="text-xs text-red-600" *ngIf="editProdFieldErrors()[p.id]?.['stockQuantity']">{{ editProdFieldErrors()[p.id]['stockQuantity'] }}</div>
          <label class="inline-flex items-center gap-2 md:col-span-2"><input type="checkbox" [checked]="e.featured" (change)="setEditField(p.id, 'featured', $any($event.target).checked)" /> Istaknut</label>
          <select class="border rounded p-2 w-full md:col-span-2" [ngModel]="e.categoryId" (ngModelChange)="setEditField(p.id, 'categoryId', $event)">
            <option [ngValue]="null">Bez kategorije</option>
            <option *ngFor="let c of categories()" [ngValue]="c.id">{{ c.name }}</option>
          </select>
          <div class="text-xs text-red-600 md:col-span-2" *ngIf="editProdFieldErrors()[p.id]?.['categoryId']">{{ editProdFieldErrors()[p.id]['categoryId'] }}</div>
          <div class="md:col-span-2 flex gap-2">
            <button (click)="saveEdit(p.id)" class="px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold">Sačuvaj</button>
            <button (click)="cancelEdit(p.id)" class="px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200">Otkaži</button>
          </div>
          <div class="text-xs text-red-600 md:col-span-6" *ngIf="editProdGeneralError()[p.id]">{{ editProdGeneralError()[p.id] }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Categories management -->
  <section class="bg-white rounded-xl shadow-sm">
    <div class="p-4 border-b font-semibold">Kategorije</div>
    <div class="p-4 grid grid-cols-1 md:grid-cols-4 gap-2 items-end">
      <input class="border rounded p-2 w-full" placeholder="Naziv" [ngModel]="newCat().name" (ngModelChange)="setNewCat('name', $event)" />
      <input class="border rounded p-2 w-full md:col-span-2" placeholder="Opis" [ngModel]="newCat().description" (ngModelChange)="setNewCat('description', $event)" />
      <button (click)="createCat()" class="px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold">Dodaj kategoriju</button>
    </div>
    <div class="divide-y">
      <div *ngFor="let c of categories()" class="p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-medium">{{ c.name }}</div>
            <div class="text-xs text-gray-500">#{{ c.id }}</div>
          </div>
          <div class="flex items-center gap-2">
            <button (click)="startCatEdit(c.id)" class="px-3 py-1.5 rounded-lg bg-gray-100 hover:bg-gray-200">Uredi</button>
            <button (click)="deleteCat(c.id)" class="px-3 py-1.5 rounded-lg bg-red-600 text-white hover:bg-red-700">Obriši</button>
          </div>
        </div>
        <div *ngIf="editCat()[c.id] as e" class="mt-3 grid grid-cols-1 md:grid-cols-4 gap-2 items-end">
          <input class="border rounded p-2 w-full" placeholder="Naziv" [ngModel]="e.name" (ngModelChange)="setCatEditField(c.id, 'name', $event)" />
          <div class="text-xs text-red-600" *ngIf="editCatFieldErrors()[c.id]?.['name']">{{ editCatFieldErrors()[c.id]['name'] }}</div>
          <input class="border rounded p-2 w-full md:col-span-2" placeholder="Opis" [ngModel]="e.description" (ngModelChange)="setCatEditField(c.id, 'description', $event)" />
          <div class="flex gap-2">
            <button (click)="saveCatEdit(c.id)" class="px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold">Sačuvaj</button>
            <button (click)="cancelCatEdit(c.id)" class="px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200">Otkaži</button>
          </div>
          <div class="text-xs text-red-600 md:col-span-4" *ngIf="editCatGeneralError()[c.id]">{{ editCatGeneralError()[c.id] }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Order status update -->
  <section class="bg-white rounded-xl shadow-sm">
    <div class="p-4 border-b font-semibold">Ažuriranje statusa porudžbine</div>
    <div class="p-4 grid grid-cols-1 md:grid-cols-4 gap-2 items-end">
      <input class="border rounded p-2 w-full" type="number" placeholder="ID porudžbine" [ngModel]="updOrderId()" (ngModelChange)="updOrderId.set($event)" />
      <select class="border rounded p-2 w-full md:col-span-2" [ngModel]="updStatus()" (ngModelChange)="updStatus.set($event)">
        <option value="PENDING">PENDING</option>
        <option value="SHIPPED">SHIPPED</option>
        <option value="DELIVERED">DELIVERED</option>
        <option value="CANCELED">CANCELED</option>
        <option value="RETURNED">RETURNED</option>
        <option value="REFUNDED">REFUNDED</option>
        <option value="COMPLETED">COMPLETED</option>
        <option value="ON_HOLD">ON_HOLD</option>
        <option value="AWAITING_PAYMENT">AWAITING_PAYMENT</option>
      </select>
      <button (click)="updateOrderStatus()" class="px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold">Ažuriraj</button>
    </div>
  </section>

  <!-- Orders list by user -->
  <section class="bg-white rounded-xl shadow-sm">
    <div class="p-4 border-b font-semibold">Porudžbine po korisniku</div>
    <div class="p-4 grid grid-cols-1 md:grid-cols-4 gap-2 items-end">
      <input class="border rounded p-2 w-full" type="number" placeholder="ID korisnika" [ngModel]="ordersUserId()" (ngModelChange)="ordersUserId.set($event)" />
      <button (click)="loadOrdersByUser()" class="px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white font-semibold">Učitaj</button>
      <div class="text-sm text-gray-500 md:col-span-2" *ngIf="ordersLoading()">Učitavanje...</div>
      <div class="text-sm text-red-600 md:col-span-2" *ngIf="ordersError()">{{ ordersError() }}</div>
    </div>
    <div class="overflow-x-auto" *ngIf="ordersByUser().length">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-gray-600">
            <th class="p-3">ID</th>
            <th class="p-3">Datum</th>
            <th class="p-3">Status</th>
            <th class="p-3">Stavki</th>
            <th class="p-3">Ukupno</th>
            <th class="p-3">Detalji</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let o of ordersByUser()" class="border-t">
            <td class="p-3">{{ o.id }}</td>
            <td class="p-3">{{ o.orderDate | date:'short' }}</td>
            <td class="p-3">{{ o.status }}</td>
            <td class="p-3">{{ o.items?.length || 0 }}</td>
            <td class="p-3 font-semibold">{{ o.totalPrice | currency:'RSD':'symbol':'1.0-0':'sr-RS' }}</td>
            <td class="p-3"><a [routerLink]="['/orders', o.id]" class="text-brand-700 hover:underline">Otvori</a></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="p-4 text-gray-500" *ngIf="!ordersLoading() && !ordersByUser().length">Nema rezultata.</div>
  </section>
</div>
